<script>
  const nickname = document.getElementById("nickname").innerText;
  const userList = document.getElementById("userList");
  const ws = new WebSocket(`ws://${window.location.host}`);

  // Send join event on WebSocket connection
  ws.addEventListener("open", () => {
    ws.send(JSON.stringify({ type: "join", nickname }));
  });

  // Handle incoming WebSocket messages
  ws.addEventListener("message", (event) => {
    const data = JSON.parse(event.data);

    if (data.type === "updateUsers") {
      userList.innerHTML = ""; // Clear the current list
      data.activeUsers.forEach((user) => {
        const li = document.createElement("li");
        li.innerText = user; // Add each user to the list
        userList.appendChild(li);
      });
    }
  });

  // Handle leaving the room
  document.getElementById("leaveForm").addEventListener("submit", (e) => {
    e.preventDefault();
    ws.send(JSON.stringify({ type: "leave", nickname }));
    window.location.href = "/";
  });

  // Notify server on page unload
  window.addEventListener("beforeunload", () => {
    ws.send(JSON.stringify({ type: "leave", nickname }));
  });
</script>
